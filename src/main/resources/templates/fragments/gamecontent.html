<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<div class="tabbable boxed parentTabs">
    <ul class="nav nav-tabs gamegroup">
        <li class="nav-item" th:each="gamegroup: ${gamegroups}">
            <a class="nav-link gamegroup" th:href="@{'#gamegroupid'+${gamegroup.id}}"
               th:attr="data-el_id='gamegroupid'+${gamegroup.id}"
               data-toggle="tab" th:text="${gamegroup.groupName}"></a>
            <!-- do split after id or something?
            <ul class="nav nav-tabs visually-hidden subgroup">
                <li class="nav-item" th:each="subgroup: ${gamegroup.subgroups}">
                    <a class="nav-link" href="#" th:text="${subgroup.subgroupName}"></a>
                </li>
            </ul>
            -->
        </li>
    </ul>
    <th:block th:each="gamegroup: ${gamegroups}">
        <ul class="nav nav-tabs subgroup visually-hidden"
            th:attr="id='gamegroupid'+${gamegroup.id}, data-el_id='gamegroupid'+${gamegroup.id}">
            <li class="nav-item" th:each="subgroup: ${gamegroup.subgroups}">
                <a class="nav-link subgroup" th:attr="id='songSubgroup'+${subgroup.id}" href="" th:text="${subgroup.subgroupName}"></a>
            </li>
        </ul>
    </th:block>
    <table class="table" th:if="${songSubgroups!=null}">
        <thead>
        <tr>
            <th scope="col">Country</th>
            <th scope="col">Band</th>
            <th scope="col">Song</th>
            <th scope="col">Genre</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="songSubgroup : ${songSubgroups}" th:attr="data-el_id='songSubgroup'+${songSubgroup.subgroup.id}">
            <td>
                <th:block th:each="authorSong : ${songSubgroup.song.authorSongList}">
                    <th:block th:each="authorCountry : ${authorSong.authorAlias.author.authorCountries}">
                        <img th:src="${authorCountry.country.countryLink}">
                    </th:block>
                </th:block>
            </td>
            <th:block th:each="authorSong : ${songSubgroup.song.authorSongList}">
                <td th:text="${songSubgroup.ingameDisplayBand} ? ${songSubgroup.ingameDisplayBand} : ${authorSong.authorAlias.alias} "></td>
            </th:block>
            <td th:text="${songSubgroup.ingameDisplayBand} ? ${songSubgroup.ingameDisplayTitle} : ${songSubgroup.song.officialDisplayTitle} "></td>
            <td>Something</td>
            <td>
                <th:button data-bs-toggle="modal" data-bs-target="#videoModal" th:attr="data-tagVideo=${songSubgroup.srcId} ? ${songSubgroup.srcId} : ${songSubgroup.song.srcId}">
                    <img th:src="@{/images/znakwodny.png}" width="25" height="25">
                </th:button>
            </td>

        </tr>
        </tbody>
    </table>

</div>

<div class="modal fade" id="videoModal" role="dialog" data-bs-keyboard="false" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="ratio ratio-16x9">
                    <iframe src="" allow="autoplay;" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    $(document).ready(function() {
        console.log("freeman");
        var firstGameGroup = $("a.gamegroup:first")[0];
        if (firstGameGroup!=null){
            $(firstGameGroup).click();
        }
        autoPlayYouTubeModal();
    });
    $("a.gamegroup").click(function(e) {
        console.log("jesus");
        e.preventDefault();
        $(".gamegroup.active").each(function(){
            $(this).removeClass("active");
        });
        $(this).addClass("active");
        var aId = $(this).attr('data-el_id');
            $(document).find("ul.subgroup[data-el_id='"+aId+"']").each(function(){
                 $(this).removeClass("visually-hidden");
            });
            $(document).find("ul.subgroup:not([data-el_id='"+aId+"'])").each(function(){
                 $(this).addClass("visually-hidden");
            });
        $(this).removeClass("visually-hidden");
        var div = $($(this).attr('href'))[0];
        $(div).addClass("active");
        $(div).removeClass("visually-hidden");
        $(div).find("a").first().click();
    });
    $("a.subgroup").click(function(e) {
        e.preventDefault();
        $(".subgroup.active").each(function(){
            $(this).removeClass("active");
        });
        $(this).addClass("active");
        $(this).removeClass("visually-hidden");
        var aId = $(this).attr('id');
        $(document).find("tr[data-el_id='"+aId+"']").each(function(){
             $(this).removeClass("visually-hidden");
        });
        $(document).find("tr:has(td):not([data-el_id="+aId+"])").each(function(){
             $(this).addClass("visually-hidden");
        });
    });

function autoPlayYouTubeModal() {
  var triggerOpen = $("body").find('[data-tagVideo]');
  triggerOpen.click(function() {
      var theModal = $(this).data("bs-target"),
      videoSRC = $(this).attr("data-tagVideo"),
      videoSRCauto = "https://www.youtube.com/embed/"+videoSRC + "?autoplay=1";
      $(theModal + ' iframe').attr('src', videoSRCauto);
      $(theModal + ' button.btn-close').click(function() {
        $(theModal + ' iframe').attr('src', videoSRC);
      });
      $("#videoModal").click(function(ev){
           if (ev.originalEvent.target.className!="modal-body"){
            $(theModal + ' iframe').attr('src', videoSRC);
          }
      });
  });
}
</script>
</html>